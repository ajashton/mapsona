var map=null,baselayers=[],myswitcher;OpenLayers.ImgPath="images/openlayers/";function add_kml(a,b,c){c=c?{extractStyles:true,extractAttributes:true,maxDepth:2}:[];a=new OpenLayers.Layer.GML(a,b,{format:OpenLayers.Format.KML,projection:new OpenLayers.Projection("EPSG:4326"),formatOptions:c});map.addLayer(a)}
function hash_to_string(a){var b,c;b="";for(c in a)b+=typeof a[c].prototype!=="undefined"?c+":"+a[c].prototype.CLASS_NAME+",\n":a[c].CLASS_NAME==="OpenLayers.Projection"?c+": new "+a[c].CLASS_NAME+"('"+a[c].projCode+"'),":typeof a[c]==="object"?c+":{"+hash_to_string(a[c])+"},":c+":"+a[c]+",\n";return b}$.fn.get_layers=function(){var a,b;a=this[0].layers.slice();b=[];$.each(a,function(){this.isBaseLayer===false&&b.push(this)});return $({layers:b})};
function layer_serialize(a){if(typeof a.styleMap.name!=="undefined"&&typeof default_styles[a.styleMap.name]!=="undefined")a.options.styleMap="default_styles['"+a.styleMap.name+"']";return"new "+a.CLASS_NAME+"( '"+a.name+"', '"+a.url+"', {"+hash_to_string(a.options)+"})"}$.fn.serialize_layers=function(){var a="var layers = ["+this[0].layers.map(layer_serialize).join(",\n")+"]";return a};
function osm_getTileURL(a){var b,c,d;b=this.map.getResolution();c=Math.round((a.left-this.maxExtent.left)/(b*this.tileSize.w));a=Math.round((this.maxExtent.top-a.top)/(b*this.tileSize.h));b=this.map.getZoom();d=Math.pow(2,b);if(a<0||a>=d)return OpenLayers.Util.getImagesLocation()+"404.png";else{c=(c%d+d)%d;return this.url+b+"/"+c+"/"+a+"."+this.type}}
$(document).ready(function(){function a(){f.unselect(selectedFeature)}function b(e){var g;selectedFeature=e;g=new OpenLayers.Popup.FramedCloud2("stick",e.geometry.getBounds().getCenterLonLat(),null,"<div style='font-size:.8em'>Feature: "+e.id+"<br />Area: "+e.geometry.getArea()+"</div>",null,true,a);e.popup=g;map.addPopup(g)}function c(e){map.removePopup(e.popup);e.popup.destroy();e.popup=null}var d,h,f;d={projection:new OpenLayers.Projection("EPSG:900913"),displayProjection:new OpenLayers.Projection("EPSG:4326"),
units:"m",maxResolution:156543.0339,maxExtent:new OpenLayers.Bounds(-2.003750834E7,-2.003750834E7,2.003750834E7,2.003750834E7)};map=new OpenLayers.Map("map",d);d=new OpenLayers.Layer.TMS("OpenStreetMap (Mapnik)","http://tile.openstreetmap.org/",{type:"png",getURL:osm_getTileURL,displayOutsideMaxExtent:true,maxExtent:new OpenLayers.Bounds(-2.003750834E7,-2.003750834E7,2.003750834E7,2.003750834E7),attribution:'<a href="http://www.openstreetmap.org/">OpenStreetMap</a>'});h=new OpenLayers.Layer.TMS("Afghanistan Roads",
"",{type:"png",layername:"roads",attribution:'<a href="http://www.mapbox.org/">MapBox</a>'});map.addLayers([d,h]);if(typeof layers!=="undefined"){map.addLayers(layers);f=new OpenLayers.Control.SelectFeature(layers,{onSelect:b,onUnselect:c})}map.addControl(f);f.activate();map.zoomToMaxExtent();OpenLayersPlusBlockswitcher._attach($(".openlayers-blockswitcher"),map)});
$(document).ready(function(){$("#add_layer").click(function(){var a,b,c,d;$("#layer_type").val();a=$("#layer_name").val();b=$("#extract").val()==="on";c=$("#layer_url").val();d(a,c,b)});$("#save_layer").click(function(){var a,b;a=$(map).get_layers().serialize_layers();$("#save_filename").click();b=document.location.href.substring(0,document.location.href.lastIndexOf("/")+1);b=b+"layers.js";b=$.twFile.convertUriToLocalPath(b);$.twFile.save(b,a)});$("#file_trigger").click(function(){$("#layer_filename").click()});
$("#layer_filename").change(function(){$("#layer_url").val($(this).val())})});

